{% extends 'base.html' %}
{% block title %}ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ{% endblock %}

{% block content %}
<div class="profile-page">

    <!-- Ğ¨Ğ°Ğ¿ĞºĞ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ -->
    <div class="profile-hero">
        <div class="profile-avatar">
            {% if user.avatar %}
            <img src="{{ user.avatar.url }}" alt="">
            {% else %}
            <div class="avatar-placeholder">{{ user.username|first|upper }}</div>
            {% endif %}
        </div>
        <div class="profile-info">
            <h1>{{ user.username }}</h1>
            <p class="profile-email">{{ user.email }}</p>
            <p class="profile-joined">ĞĞ° ÑĞ°Ğ¹Ñ‚Ğµ Ñ {{ user.date_joined|date:"d.m.Y" }}</p>
        </div>
    </div>

    <!-- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-icon">ğŸ”¥</div>
            <div class="stat-card-num">{{ profile.streak }}</div>
            <div class="stat-card-label">Ğ”Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">ğŸ†</div>
            <div class="stat-card-num">{{ profile.longest_streak }}</div>
            <div class="stat-card-label">Ğ ĞµĞºĞ¾Ñ€Ğ´</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">ğŸª™</div>
            <div class="stat-card-num">{{ profile.coins }}</div>
            <div class="stat-card-label">ĞœĞ¾Ğ½ĞµÑ‚</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">ğŸ§Š</div>
            <div class="stat-card-num">{{ profile.freezes }}</div>
            <div class="stat-card-label">Ğ—Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ·Ğ¾Ğº</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">ğŸ“š</div>
            <div class="stat-card-num">{{ courses_count }}</div>
            <div class="stat-card-label">ĞšÑƒÑ€ÑĞ¾Ğ²</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">ğŸ“Š</div>
            <div class="stat-card-num">{{ avg_percent }}%</div>
            <div class="stat-card-label">Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ»</div>
        </div>
    </div>

    <div class="profile-columns">

        <!-- ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ñ‹ -->
        <div class="profile-section">
            <h2>ğŸ“ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ñ‹</h2>
            {% if test_results %}
            <div class="test-history">
                {% for result in test_results %}
                <div class="test-history-row">
                    <div class="test-history-info">
                        <span class="test-history-course">{{ result.course.title }}</span>
                        <span class="test-history-date">{{ result.created_at|date:"d.m H:i" }}</span>
                    </div>
                    <div class="test-history-score
                        {% if result.percent >= 90 %}score-great
                        {% elif result.percent >= 70 %}score-good
                        {% elif result.percent >= 50 %}score-ok
                        {% else %}score-bad{% endif %}">
                        {{ result.percent }}%
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-hint">Ğ¢ĞµÑÑ‚Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚</p>
            {% endif %}
        </div>

        <!-- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ -->
        <div class="profile-section">
            <h2>âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</h2>
            <form method="post">
                {% csrf_token %}
                <label>Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°</label>
                <select name="interface_language" class="form-input">
                    <option value="ru" {% if fresh_user.interface_language == 'ru' %}selected{% endif %}>ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹
                    </option>
                    <option value="en" {% if fresh_user.interface_language == 'en' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ English
                    </option>
                    <option value="de" {% if fresh_user.interface_language == 'de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch
                    </option>
                    <option value="fr" {% if fresh_user.interface_language == 'fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais
                    </option>
                    <option value="es" {% if fresh_user.interface_language == 'es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol
                    </option>
                    <option value="kk" {% if fresh_user.interface_language == 'kk' %}selected{% endif %}>ğŸ‡°ğŸ‡¿ ÒšĞ°Ğ·Ğ°Ò›ÑˆĞ°
                    </option>
                    <option value="ky" {% if fresh_user.interface_language == 'ky' %}selected{% endif %}>ğŸ”ï¸ ĞšÑ‹Ñ€Ğ³Ñ‹Ğ·Ñ‡Ğ°
                    </option>
                </select>
                <button type="submit" class="btn-primary" style="margin-top:1rem">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
            </form>
        </div>

    </div>

    <!-- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼Ğ¾Ğ½ĞµÑ‚ -->
    {% if transactions %}
    <div class="profile-section" style="margin-top:1.5rem">
        <h2>ğŸª™ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼Ğ¾Ğ½ĞµÑ‚</h2>
        <div class="coin-history">
            {% for t in transactions %}
            <div class="coin-row">
                <span class="coin-reason">
                    {% if t.reason == 'test' %}ğŸ“ Ğ¢ĞµÑÑ‚
                    {% elif t.reason == 'streak_7' %}ğŸ”¥ Ğ¡Ñ‚Ñ€Ğ¸Ğº 7 Ğ´Ğ½ĞµĞ¹
                    {% elif t.reason == 'streak_30' %}ğŸ”¥ Ğ¡Ñ‚Ñ€Ğ¸Ğº 30 Ğ´Ğ½ĞµĞ¹
                    {% elif t.reason == 'daily' %}ğŸƒ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
                    {% elif t.reason == 'purchase' %}ğŸ›ï¸ ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ°
                    {% endif %}
                </span>
                <span class="coin-date">{{ t.created_at|date:"d.m H:i" }}</span>
                <span class="coin-amount {% if t.amount > 0 %}coin-plus{% else %}coin-minus{% endif %}">
                    {% if t.amount > 0 %}+{% endif %}{{ t.amount }} ğŸª™
                </span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}