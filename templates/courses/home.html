{% extends 'base.html' %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è ‚Äî FlashCards{% endblock %}

{% block content %}
<div class="dashboard">

    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Å—Ç—Ä–∏–∫ -->
    <div class="dash-hero">
        <div class="dash-greeting">
            <h1>–ü—Ä–∏–≤–µ—Ç, {{ user.username }}! üëã</h1>
            <p class="dash-subtitle">
                {% if profile.streak > 0 %}
                    –¢—ã —É—á–∏—à—å—Å—è {{ profile.streak }} {{ profile.streak|pluralize:"–¥–µ–Ω—å,–¥–Ω—è,–¥–Ω–µ–π" }} –ø–æ–¥—Ä—è–¥. –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!
                {% else %}
                    –ù–∞—á–Ω–∏ —É—á–∏—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è –∏ –∑–∞–∂–≥–∏ —Å–≤–æ–π –æ–≥–æ–Ω—ë–∫!
                {% endif %}
            </p>
        </div>
        <div class="dash-streak-badge">
            <div class="streak-fire">üî•</div>
            <div class="streak-num">{{ profile.streak }}</div>
            <div class="streak-label">–¥–Ω–µ–π</div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="dash-stats">
        <div class="dash-stat">
            <div class="dash-stat-icon">ü™ô</div>
            <div class="dash-stat-val">{{ profile.coins }}</div>
            <div class="dash-stat-key">–ú–æ–Ω–µ—Ç</div>
        </div>
        <div class="dash-stat">
            <div class="dash-stat-icon">üßä</div>
            <div class="dash-stat-val">{{ profile.freezes }}</div>
            <div class="dash-stat-key">–ó–∞–º–æ—Ä–æ–∑–æ–∫</div>
        </div>
        <div class="dash-stat">
            <div class="dash-stat-icon">üìö</div>
            <div class="dash-stat-val">{{ courses.count }}</div>
            <div class="dash-stat-key">–ö—É—Ä—Å–æ–≤</div>
        </div>
        <div class="dash-stat">
            <div class="dash-stat-icon">üÉè</div>
            <div class="dash-stat-val">{{ total_cards }}</div>
            <div class="dash-stat-key">–ö–∞—Ä—Ç–æ—á–µ–∫</div>
        </div>
        <div class="dash-stat">
            <div class="dash-stat-icon">üìù</div>
            <div class="dash-stat-val">{{ total_tests }}</div>
            <div class="dash-stat-key">–¢–µ—Å—Ç–æ–≤</div>
        </div>
        {% if last_test %}
        <div class="dash-stat">
            <div class="dash-stat-icon">üéØ</div>
            <div class="dash-stat-val">{{ last_test.percent }}%</div>
            <div class="dash-stat-key">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç</div>
        </div>
        {% endif %}
    </div>

    <!-- –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è -->
    {% if due_cards %}
    <div class="dash-section due-section">
        <div class="section-header">
            <h2>‚è∞ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è</h2>
            <span class="badge-count">{{ due_cards.count }}</span>
        </div>
        <p class="section-hint">–≠—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Ä–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</p>
        <div class="due-cards-list">
            {% for card in due_cards %}
            <div class="due-card-row">
                <div class="due-card-texts">
                    <span class="due-front">{{ card.front_text }}</span>
                    <span class="due-arrow">‚Üí</span>
                    <span class="due-back">{{ card.back_text }}</span>
                </div>
                <a href="{% url 'study' card.course.pk %}" class="due-study-btn">–£—á–∏—Ç—å</a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="dash-actions">
        <a href="{% url 'course_create' %}" class="dash-action-btn primary">
            <span class="action-icon">‚ûï</span>
            <span class="action-label">–ù–æ–≤—ã–π –∫—É—Ä—Å</span>
        </a>
        <a href="{% url 'folder_create' %}" class="dash-action-btn">
            <span class="action-icon">üìÅ</span>
            <span class="action-label">–ù–æ–≤–∞—è –ø–∞–ø–∫–∞</span>
        </a>
        <a href="{% url 'ai_chat_list' %}" class="dash-action-btn">
            <span class="action-icon">ü§ñ</span>
            <span class="action-label">AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</span>
        </a>
        <a href="{% url 'shop' %}" class="dash-action-btn">
            <span class="action-icon">üõçÔ∏è</span>
            <span class="action-label">–ú–∞–≥–∞–∑–∏–Ω</span>
        </a>
    </div>

    <!-- –ü–∞–ø–∫–∏ -->
    {% if folders %}
    <div class="dash-section">
        <div class="section-header">
            <h2>üìÅ –ü–∞–ø–∫–∏</h2>
            <a href="{% url 'folder_create' %}" class="section-link">+ –î–æ–±–∞–≤–∏—Ç—å</a>
        </div>
        <div class="grid">
            {% for folder in folders %}
            <a href="{% url 'folder_detail' folder.pk %}" class="card-item folder-item">
                <div class="card-icon">üìÅ</div>
                <div class="card-title">{{ folder.title }}</div>
                <div class="card-meta">{{ folder.courses.count }} –∫—É—Ä—Å.</div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ù–µ–¥–∞–≤–Ω–∏–µ –∫—É—Ä—Å—ã -->
    <div class="dash-section">
        <div class="section-header">
            <h2>üìö –ö—É—Ä—Å—ã</h2>
            <a href="{% url 'course_create' %}" class="section-link">+ –î–æ–±–∞–≤–∏—Ç—å</a>
        </div>
        {% if recent_courses %}
        <div class="courses-grid">
            {% for course in recent_courses %}
            <div class="course-card">
                <div class="course-card-top">
                    <div class="course-langs">
                        {{ course.front_language|upper }} ‚Üí {{ course.back_language|upper }}
                    </div>
                    <div class="course-count">{{ course.cards_count }} –∫–∞—Ä—Ç.</div>
                </div>
                <div class="course-title">{{ course.title }}</div>
                {% if course.description %}
                <div class="course-desc">{{ course.description|truncatechars:60 }}</div>
                {% endif %}
                <div class="course-actions">
                    <a href="{% url 'study' course.pk %}" class="course-btn study-btn">‚ñ∂ –£—á–∏—Ç—å</a>
                    <a href="{% url 'test' course.pk %}" class="course-btn test-btn">üìù –¢–µ—Å—Ç</a>
                    <a href="{% url 'course_edit' course.pk %}" class="course-btn edit-btn">‚úèÔ∏è</a>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if courses.count > 4 %}
        <div style="text-align:center; margin-top:1rem">
            <button onclick="toggleAllCourses()" class="btn-secondary" id="showAllBtn">
                –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫—É—Ä—Å—ã ({{ courses.count }})
            </button>
        </div>
        <div id="allCourses" style="display:none; margin-top:1rem">
            <div class="courses-grid">
                {% for course in courses %}
                {% if forloop.counter > 4 %}
                <div class="course-card">
                    <div class="course-card-top">
                        <div class="course-langs">{{ course.front_language|upper }} ‚Üí {{ course.back_language|upper }}</div>
                        <div class="course-count">{{ course.cards_count }} –∫–∞—Ä—Ç.</div>
                    </div>
                    <div class="course-title">{{ course.title }}</div>
                    <div class="course-actions">
                        <a href="{% url 'study' course.pk %}" class="course-btn study-btn">‚ñ∂ –£—á–∏—Ç—å</a>
                        <a href="{% url 'test' course.pk %}" class="course-btn test-btn">üìù –¢–µ—Å—Ç</a>
                        <a href="{% url 'course_edit' course.pk %}" class="course-btn edit-btn">‚úèÔ∏è</a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% else %}
        <div class="empty-state">
            <p style="font-size:2.5rem">üÉè</p>
            <p>–ö—É—Ä—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
            <a href="{% url 'course_create' %}" class="btn-primary" style="margin-top:1rem;display:inline-block">
                –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å
            </a>
        </div>
        {% endif %}
    </div>

</div>

<script>
function toggleAllCourses() {
    const el = document.getElementById('allCourses');
    const btn = document.getElementById('showAllBtn');
    if (el.style.display === 'none') {
        el.style.display = 'block';
        btn.textContent = '–°–∫—Ä—ã—Ç—å';
    } else {
        el.style.display = 'none';
        btn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫—É—Ä—Å—ã ({{ courses.count }})';
    }
}
</script>
{% endblock %}