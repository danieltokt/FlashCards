{% extends 'base.html' %}
{% block title %}ะะฐะณะฐะทะธะฝ{% endblock %}

{% block content %}
<div class="page-header">
    <h1>๐๏ธ ะะฐะณะฐะทะธะฝ</h1>
</div>

<div class="shop-stats">
    <div class="shop-stat">
        <div class="shop-stat-icon">๐ฅ</div>
        <div class="shop-stat-num">{{ profile.streak }}</div>
        <div class="shop-stat-label">ะะฝะตะน ะฟะพะดััะด</div>
    </div>
    <div class="shop-stat">
        <div class="shop-stat-icon">๐ช</div>
        <div class="shop-stat-num">{{ profile.coins }}</div>
        <div class="shop-stat-label">ะะพะฝะตั</div>
    </div>
    <div class="shop-stat">
        <div class="shop-stat-icon">๐ง</div>
        <div class="shop-stat-num">{{ profile.freezes }}</div>
        <div class="shop-stat-label">ะะฐะผะพัะพะทะพะบ</div>
    </div>
    <div class="shop-stat">
        <div class="shop-stat-icon">๐</div>
        <div class="shop-stat-num">{{ profile.longest_streak }}</div>
        <div class="shop-stat-label">ะะตะบะพัะด</div>
    </div>
</div>

<h2 style="margin: 2rem 0 1rem">๐ง ะะฐะผะพัะพะทะบะธ</h2>
<p style="color:#666;margin-bottom:1.5rem">ะะฐะผะพัะพะทะบะฐ ัะพััะฐะฝัะตั ะพะณะพะฝัะบ ะตัะปะธ ัั ะฟัะพะฟัััะธะป ะดะตะฝั</p>

<div class="shop-grid">
    {% for item in freeze_prices %}
    <div class="shop-item">
        <div class="shop-item-icon">๐ง</div>
        <div class="shop-item-title">{{ item.label }}</div>
        <div class="shop-item-price">๐ช {{ item.price }} ะผะพะฝะตั</div>
        <button class="btn-primary" onclick="buyFreeze({{ item.amount }}, {{ item.price }}, this)">
            ะัะฟะธัั
        </button>
    </div>
    {% endfor %}
</div>

<div class="earn-section">
    <h2>๐ก ะะฐะบ ะทะฐัะฐะฑะฐััะฒะฐัั ะผะพะฝะตัั</h2>
    <div class="earn-grid">
        <div class="earn-item">๐ ะขะตัั 50โ69% <strong>+5 ๐ช</strong></div>
        <div class="earn-item">๐ ะขะตัั 70โ89% <strong>+10 ๐ช</strong></div>
        <div class="earn-item">๐ ะขะตัั 90โ100% <strong>+20 ๐ช</strong></div>
        <div class="earn-item">๐ ะะตัะฒัะน ะบััั ะดะฝั <strong>+3 ๐ช</strong></div>
        <div class="earn-item">๐ฅ ะกััะธะบ 7 ะดะฝะตะน <strong>+15 ๐ช</strong></div>
        <div class="earn-item">๐ฅ ะกััะธะบ 30 ะดะฝะตะน <strong>+50 ๐ช</strong></div>
    </div>
</div>

<div id="shopToast" class="shop-toast" style="display:none"></div>

<script>
function buyFreeze(amount, price, btn) {
    fetch('/shop/buy-freeze/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ amount })
    })
    .then(r => r.json())
    .then(data => {
        if (data.status === 'ok') {
            showToast(`โ ะัะฟะปะตะฝะพ! ะะพะฝะตั: ${data.coins} | ะะฐะผะพัะพะทะพะบ: ${data.freezes}`);
            document.querySelectorAll('.nav-coins').forEach(el => el.textContent = '๐ช ' + data.coins);
        } else {
            showToast('โ ' + data.message, true);
        }
    });
}

function showToast(msg, isError = false) {
    const t = document.getElementById('shopToast');
    t.textContent = msg;
    t.style.display = 'block';
    t.style.background = isError ? '#fee2e2' : '#dcfce7';
    t.style.color = isError ? '#dc2626' : '#16a34a';
    setTimeout(() => t.style.display = 'none', 3000);
}

function getCookie(name) {
    const v = `; ${document.cookie}`.split(`; ${name}=`);
    if (v.length === 2) return v.pop().split(';').shift();
}
</script>
{% endblock %}